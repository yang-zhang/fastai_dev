---

title: External data
keywords: fastai
sidebar: home_sidebar

summary: "Helper functions to download the fastai datasets"
---
<!--


#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: dev/96_data_external.ipynb
# instructions: https://docs.fast.ai/gen_doc_main.html

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Config" class="doc_header"><code>class</code> <code>Config</code><a href="https://github.com/fastai/fastai_dev/tree/master/dev/local/data/external.py#L11" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Config</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">config_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">config_path</span>
<span class="n">config_file</span><span class="p">,</span><span class="n">config_bak</span> <span class="o">=</span> <span class="n">config_path</span><span class="o">/</span><span class="s1">&#39;config.yml&#39;</span><span class="p">,</span><span class="n">config_path</span><span class="o">/</span><span class="s1">&#39;config.yml.bak&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#This cell is just to make the config file compatible with current fastai</span>
<span class="c1"># TODO: make this a method that auto-runs as needed</span>
<span class="k">if</span> <span class="s1">&#39;data_archive_path&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_archive_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">data_path</span>
    <span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">config_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">config_bak</span><span class="p">)</span>
<span class="c1">#Test default config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">config_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">archive</span><span class="p">,</span> <span class="n">config_path</span><span class="o">/</span><span class="s1">&#39;archive&#39;</span><span class="p">)</span>

<span class="c1">#Test change in config</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;archive_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
<span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">archive</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">config_bak</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">config_bak</span><span class="p">,</span> <span class="n">config_file</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="URLs" class="doc_header"><code>class</code> <code>URLs</code><a href="https://github.com/fastai/fastai_dev/tree/master/dev/local/data/external.py#L51" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>URLs</code>()</p>
</blockquote>
<p>Global constants for dataset and model URLs.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Downloading">Downloading<a class="anchor-link" href="#Downloading">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_url" class="doc_header"><code>download_url</code><a href="https://github.com/fastai/fastai_dev/tree/master/dev/local/data/external.py#L132" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_url</code>(<strong><code>url</code></strong>, <strong><code>dest</code></strong>, <strong><code>overwrite</code></strong>=<em><code>False</code></em>, <strong><code>pbar</code></strong>=<em><code>None</code></em>, <strong><code>show_progress</code></strong>=<em><code>True</code></em>, <strong><code>chunk_size</code></strong>=<em><code>1048576</code></em>, <strong><code>timeout</code></strong>=<em><code>4</code></em>, <strong><code>retries</code></strong>=<em><code>5</code></em>)</p>
</blockquote>
<p>Download <code>url</code> to <code>dest</code> unless it exists and not <code>overwrite</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;http://files.fast.ai/data/examples/mnist_tiny.tgz&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist_tiny.tgz&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">fname</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c1">#Launching the function again doesn&#39;t trigger a download since the file is already there.</span>
    <span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
    <span class="c1">#But with the overwrite option, we download it again.</span>
    <span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">test_ne</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
<span class="k">finally</span><span class="p">:</span> <span class="n">fname</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">download_url</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{URLs.MNIST_TINY}</span><span class="s2">.tgz&quot;</span><span class="p">,</span> <span class="s1">&#39;data/mnist_tiny.tgz&#39;</span><span class="p">)</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_TINY</span><span class="p">),</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">/</span><span class="s1">&#39;data&#39;</span><span class="o">/</span><span class="s1">&#39;mnist_tiny.tgz&#39;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_data" class="doc_header"><code>download_data</code><a href="https://github.com/fastai/fastai_dev/tree/master/dev/local/data/external.py#L164" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_data</code>(<strong><code>url</code></strong>, <strong><code>fname</code></strong>=<em><code>None</code></em>, <strong><code>c_key</code></strong>=<em><code>'archive'</code></em>, <strong><code>force_download</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Download <code>url</code> to <code>fname</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If <code>fname</code> is None, it will default to the archive folder you have in your config file (or data, model if you specify a different <code>c_key</code>) followed by the last part of the url: for instance <a href="/data.external.html#URLs.MNIST_SAMPLE"><code>URLs.MNIST_SAMPLE</code></a> is <code>http://files.fast.ai/data/examples/mnist_sample.tgz</code> and the default value for <code>fname</code> will be <code>~/.fastai/archive/mnist_sample.tgz</code>.</p>
<p>If <code>force_download=True</code>, the file is alwayd downloaded. Otherwise, it's only when the file doesn't exists that the download is triggered.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">download_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_SAMPLE</span><span class="p">),</span> <span class="n">config</span><span class="o">.</span><span class="n">archive</span><span class="o">/</span><span class="s1">&#39;mnist_sample.tgz&#39;</span><span class="p">)</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">download_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_TINY</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist.tgz&#39;</span><span class="p">)),</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist.tgz&#39;</span><span class="p">))</span>
<span class="k">finally</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist.tgz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">tst_model</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">/</span><span class="s1">&#39;mnist_tiny.tgz&#39;</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">download_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_TINY</span><span class="p">,</span> <span class="n">c_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">),</span> <span class="n">tst_model</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tst_model</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tst_model</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="n">tst_model</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Extract">Extract<a class="anchor-link" href="#Extract">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tar_extract" class="doc_header"><code>tar_extract</code><a href="https://github.com/fastai/fastai_dev/tree/master/dev/local/data/external.py#L189" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tar_extract</code>(<strong><code>fname</code></strong>, <strong><code>dest</code></strong>)</p>
</blockquote>
<p>Extract <code>fname</code> to <code>dest</code> using <code>tarfile</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/data.external.html#tar_extract"><code>tar_extract</code></a> is used by default in <a href="/data.external.html#untar_data"><code>untar_data</code></a> to decompress the downloaded file.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="untar_data" class="doc_header"><code>untar_data</code><a href="https://github.com/fastai/fastai_dev/tree/master/dev/local/data/external.py#L194" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>untar_data</code>(<strong><code>url</code></strong>, <strong><code>fname</code></strong>=<em><code>None</code></em>, <strong><code>dest</code></strong>=<em><code>None</code></em>, <strong><code>c_key</code></strong>=<em><code>'data'</code></em>, <strong><code>force_download</code></strong>=<em><code>False</code></em>, <strong><code>extract_func</code></strong>=<em><code>'tar_extract'</code></em>)</p>
</blockquote>
<p>Download <code>url</code> to <code>fname</code> if <code>dest</code> doesn't exist, and un-tgz to folder <code>dest</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/data.external.html#untar_data"><code>untar_data</code></a> is a convenience function for the fastai datasets, intended to work with the urls in <a href="/data.external.html#URLs"><code>URLs</code></a>. You can use it with another url only if it ends with <code>.tgz</code> (otherwise the function can download it but not decompress it). For other extensions, you should use <a href="/data.external.html#download_data"><code>download_data</code></a> then the necessary decompress function.</p>
<p>If <code>fname</code> is specified, the data will be downloaded to that destination, otherwise it will default to the archive path in your config file (default <code>~/.fastai/archive/</code>) followed by the last part of your url. For instance <a href="/data.external.html#URLs.MNIST_SAMPLE"><code>URLs.MNIST_SAMPLE</code></a> is <code>http://files.fast.ai/data/examples/mnist_sample.tgz</code> and the default value for <code>fname</code> will be <code>~/.fastai/archive/mnist_sample.tgz</code>.</p>
<p>If <code>dest</code> is specified, the data will be decompressed to that folder. Otherwise, it will default to the data path (or model/archive if you specify a different <code>c_key</code>) in your config file (default <code>~/.fastai/data/</code>) followed by the last part of your url without extension. For instance <a href="/data.external.html#URLs.MNIST_SAMPLE"><code>URLs.MNIST_SAMPLE</code></a> is <code>http://files.fast.ai/data/examples/mnist_sample.tgz</code> and the default value for <code>dest</code> will be <code>~/.fastai/data/mnist_sample</code>.</p>
<p><code>force_download=True</code> will retrigger a download, otherwise the behavior is to:</p>
<ul>
<li>not do anything when <code>dest</code> exists</li>
<li>otherwise decompress <code>fname</code> to <code>dest</code> if <code>fname</code> exists</li>
<li>otherwise download then decompress <code>fname</code> to <code>dest</code></li>
</ul>
<p>You can pass any function that takes <code>fname</code> and <code>dest</code> arguments as <code>extract_func</code>. By default, <a href="/data.external.html#tar_extract"><code>tar_extract</code></a> is used, which extracts the file using <code>tarfile</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_SAMPLE</span><span class="p">),</span> <span class="n">config</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="s1">&#39;mnist_sample&#39;</span><span class="p">)</span>

<span class="c1">#Test specific fname</span>
<span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_TINY</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;mnist_tiny.tgz&#39;</span><span class="p">,</span> <span class="n">force_download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist_tiny.tgz&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
    
<span class="c1">#Test specific dest</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_TINY</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist_tiny&#39;</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist_tiny&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;mnist_tiny&#39;</span><span class="p">))</span>

<span class="c1">#Test c_key</span>
<span class="n">tst_model</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="o">/</span><span class="s1">&#39;mnist_sample&#39;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_SAMPLE</span><span class="p">,</span> <span class="n">c_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">),</span> <span class="n">tst_model</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">tst_model</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.tgz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="c1">#Archive wasn&#39;t downloaded in the models path</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">archive</span><span class="o">/</span><span class="s1">&#39;mnist_sample.tgz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="c1">#Archive was downloaded there</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tst_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

